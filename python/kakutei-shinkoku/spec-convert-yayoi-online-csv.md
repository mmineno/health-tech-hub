# CSV 変換ツール仕様書

## 1. 目的

一般的な CSV 形式の取引データを「やよいの青色申告 オンライン」のインポート形式に変換する Python スクリプト

## 2. 対象データ

### 2.1 入力データ形式

以下の列を持つ CSV 形式

- 対象外: 空白でない場合は処理対象外
- 発生日: YYYY/MM/DD 形式の日付
- 取引先: 取引先名称
- 勘定科目: 有効な会計勘定科目
- 税込金額: 数値（正の整数）
- 税抜金額: 数値（正の整数）
- 消費税額: 数値（正の整数）
- 摘要: 任意の説明文
- インボイス登録番号: インボイス番号
- ファイル名: 関連ファイル名

### 2.2 出力データ形式

「やよいの青色申告 オンライン」の取引データインポート形式

- エンコーディング: SHIFT-JIS
- 区切り文字: カンマ
- 識別フラグ: 2000（1 行の仕訳データ）

## 3. 変換ルール

### 3.1 基本ルール

- 「対象外」列が空白のデータのみ処理
- 勘定科目が有効なものであるか検証
- 発生日、金額などの基本的なデータ検証を実施

### 3.2 勘定科目処理ルール

勘定科目の種類に応じて仕訳形式を決定:

- 費用科目: 借方に計上、貸方に「現金」
- 収益科目: 借方に「現金」、貸方に計上
- その他の科目: 借方に該当科目、貸方に「現金」

### 3.3 補助項目処理

- 摘要は最大 30 文字まで
- インボイス登録番号がある場合は摘要に「[インボイス:番号]」の形式で追記
- 取引先名は最大 15 文字まで

## 4. 勘定科目リスト

次の勘定科目グループが有効:

### 4.1 資産科目

現金、小口現金、普通預金、当座預金、定期預金、売掛金、未収金、有価証券、商品、製品、原材料、仕掛品、貯蔵品、前払費用、立替金、仮払金、短期貸付金、建物、建物付属設備、構築物、機械装置、車両運搬具、工具器具備品、土地、電話加入権、ソフトウェア、長期前払費用、敷金、保証金、繰延資産、クレジットカード

### 4.2 負債科目

買掛金、未払金、短期借入金、前受金、預り金、仮受金、未払費用、未払法人税等、未払消費税、未払事業税、賞与引当金、長期借入金、退職給付引当金

### 4.3 純資産科目

資本金、元入金、資本準備金、利益準備金、繰越利益剰余金、当期純利益

### 4.4 収益科目

売上高、製品売上高、商品売上高、サービス売上高、雑収入、受取利息、受取配当金、為替差益、有価証券売却益、固定資産売却益

### 4.5 費用科目

仕入高、製品仕入高、商品仕入高、外注費、給料賃金、役員報酬、アルバイト給与、賞与、退職金、法定福利費、福利厚生費、雑給、通勤費、広告宣伝費、荷造運賃、販売促進費、旅費交通費、通信費、交際費、会議費、接待交際費、事務用品費、消耗品費、水道光熱費、新聞図書費、支払手数料、支払報酬、支払保険料、修繕費、保守料、リース料、地代家賃、家賃、管理費、租税公課、減価償却費、貸倒引当金繰入、雑費、支払利息、為替差損、有価証券売却損、固定資産売却損、貸倒損失、雑損失

## 5. エラー処理

次の場合にエラーメッセージを出力:

- 発生日が無効な形式
- 勘定科目が空または未知の科目
- 税込金額が空または無効な値
- 処理可能なデータがない場合

## 6. 出力形式詳細

| 列名         | 値                            | 説明                 |
| ------------ | ----------------------------- | -------------------- |
| 識別フラグ   | 2000                          | 1 行の仕訳データ     |
| 伝票 No      | 空                            |                      |
| 決算         | 空                            |                      |
| 取引日付     | 入力の「発生日」              | YYYY/MM/DD 形式      |
| 借方勘定科目 | 勘定科目または「現金」        | 勘定科目の種類による |
| 借方補助科目 | 空                            |                      |
| 借方部門     | 空                            |                      |
| 借方税区分   | 空または税区分                |                      |
| 借方金額     | 入力の「税込金額」            |                      |
| 借方税金額   | 入力の「消費税額」            |                      |
| 貸方勘定科目 | 「現金」または勘定科目        | 勘定科目の種類による |
| 貸方補助科目 | 空                            |                      |
| 貸方部門     | 空                            |                      |
| 貸方税区分   | 空または税区分                |                      |
| 貸方金額     | 入力の「税込金額」            |                      |
| 貸方税金額   | 入力の「消費税額」            |                      |
| 摘要         | 入力の「摘要」+インボイス情報 | 最大 30 文字         |
| 番号         | 空                            |                      |
| 期日         | 空                            |                      |
| タイプ       | 空                            |                      |
| 生成元       | 空                            |                      |
| 仕訳メモ     | 空                            |                      |
| 付箋 1       | 0                             | 指定なし             |
| 付箋 2       | 空                            |                      |
| 調整         | 空                            |                      |
| 借方取引先名 | 入力の「取引先」              | 最大 15 文字         |
| 貸方取引先名 | 入力の「取引先」              | 最大 15 文字         |

## 7. 使用方法

```
python convert-yayoi-online-csv.py 入力ファイル.csv 出力ファイル.csv
```

変換に成功した場合は成功メッセージと変換された行数を表示し、失敗した場合はエラーメッセージを表示する。
